# UniFetch

## 介绍

对 [fetch](https://github.com/github/fetch#json) 相关数据接口的通用封装，支持 get，post 和 jsonp 请求。

## 使用

`tnpm install @ali/uniform-react-components --save`
`import {fetch, fetchJsonp, setUrlSearchParams, setFormData} from '@ali/uniform-react-components/lib/UniFetch/index';`

## apis

- **fetch**
    封装后的 fetch 接口  
       
    > example 

    ```javascript
      /**
       * get 请求例子
       */
      function fetchGet1(data) {
        let u = setUrlSearchParams(data);
        return fetch('/video/v5video/item/search.htm?' + u, {
          credentials: 'include'
        });
      }
    
      /**
       * post 请求例子
       */
      function fetchPost1(data) {
        return fetch('/video/v5video/item/add.htm', {
          method: 'POST',
          body: setUrlSearchParams(data),
          credentials: 'include'
        });
      }
    ```
    
- **fetchGet**
       
    > example 

    ```javascript
        fetchGet('/common/getToken.json');
    ```
    
- **fetchPost**
       
    以`application/x-www-form-urlencoded`格式编码数据  
    
    > example 

    ```javascript
    fetchPost(`/cms/main/page_setup/channel/changeKey.json`, data);
    ```
    
- **fetchPostFormData**
       
    以`multipart/form-data`格式编码数据  
    
    > example 

    ```javascript
    fetchPostFormData(`/cms/main/page_setup/channel/changeKey.json`, data);
    ```
    
    
- **fetchJsonp**
    封装后的 fetchJsonp 接口
    
    > example
    
    ```javascript
    
      /**
       * jsonp 请求例子
       */
      function fetchJsonpSample(tags) {
        let u = setUrlSearchParams({tags: tags});
        return fetchJsonp('/common/jsonp/getTagName.htm?'+u);
      }
    ```  
      
- **setUrlSearchParams**
    将 json 数据转换为 URLSearchParams 格式
    
    > example
    
    ```javascript
    let u = setUrlSearchParams({tags: '0,1'});
    ```

- **setFormData**
    将 json 数据转换为 FormData 格式
    
    > example
    
    ```javascript
    let u = setFormData({tags: '2,3'});
    ```
    
## 项目实战示例

```javascript
import {fetch, fetchJsonp, setUrlSearchParams, setFormData, fetchGet, fetchPost} from './index';

// 数据请求示例
class RequestManager {
  /**
   * get 请求例子
   */
  static fetchGet1(data) {
    let u = setUrlSearchParams(data);
    return fetch('/video/v5video/item/search.htm?' + u, {
      credentials: 'include'
    });
  }

  /**
   * post 请求例子
   */
  static fetchPost1(data) {
    return fetch('/video/v5video/item/add.htm', {
      method: 'POST',
      body: setFormData(data),
      credentials: 'include'
    });
  }

  /**
   * jsonp 请求例子
   */
  static fetchJsonpSample(tags) {
    return fetchJsonp('/common/jsonp/getTagName.htm?', {tags: tags});
  }

  static fetchGet2(data) {
    return fetchGet('/video/v5video/item/search.htm?', data);
  }

  static fetchPost2(data) {
    return fetchPost('/video/v5video/item/add.htm', data);
  }

  static getToken() {
    return fetchGet('/common/getToken.json');
  }

  static setChannelKey(data){
    return fetchPost(`/cms/main/page_setup/channel/changeKey.json`, data)
  }

}

RequestManager.getToken()
.then(data => console.log('=======fetchGet====== ', data));

RequestManager.setChannelKey({id: 1, name: 'haha'})
.then(data => console.log('=======fetchPost====== ', data));

RequestManager.fetchGet1()
.then(data => console.log('=======fetchGet====== ', data));

RequestManager.fetchPost1()
.then(data => console.log('=======fetchPost====== ', data));

RequestManager.fetchJsonpSample('5')
.then(data => console.log('=======getTagName====== ', data));

RequestManager.fetchGet2()
.then(data => console.log('=======fetchGet====== ', data));

RequestManager.fetchPost2()
.then(data => console.log('=======fetchPost====== ', data));


```

## 常见问题

Q: 低版本浏览器，不支持 `URLSearchParams`，post 请求出错。  
A: 用了 `url-search-params` 这个 polyfill，但是在 json 数据复杂时仍然存在问题，此时推荐用 `setFormData(obj)`

 